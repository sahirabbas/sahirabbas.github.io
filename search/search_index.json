{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to the Beginners DevOps Docs On this site, I am trying to post DevOps-related documentation which will help beginners in their day-to-day DevOps activities.","title":"Home"},{"location":"#welcome-to-the-beginners-devops-docs","text":"On this site, I am trying to post DevOps-related documentation which will help beginners in their day-to-day DevOps activities.","title":"Welcome to the Beginners DevOps Docs"},{"location":"Evicted_Pod_Remove/","text":"Kubernetes \u2014 Automatically Cleaning Up Evicted Pods (Workaround) Note: This is a workaround method, not an actual method to remove evicted pods. Pod eviction can happen for plenty of reasons. A few examples are: VerticalPodAutoscaler scaling a Pod When a Node is under resource pressure (CPU, memory, etc.) When a higher priority Pod preempts a lower priority Pod when a Pod\u2019s emptyDir usage exceeds the configured size limit For some reason, the evicted pod will not be removed automatically. In this article, we are introducing a workaround to remove the evicted pods automatically using cronjobs. Prerequisites Kubernetes Cluster admin rights. helm We have developed a helm template for deploying the cronjob for cleanup evicted pods. The chart will deploy the following resource on your Kubernetes Cluster. Namespace Service account Cluster Role Cluster Rolebinding Cronjob Deployment: git clone https://github.com/sahirabbas/remove_evicted_pods_workaround.git Deploy the cronjob using helm. cd remove_evicted_pods_workaround helm install <name> . By default, the chart will create a namespace evicted-pods-cleanup and will deploy the cronjob on the namespace and the cronjob will run every 30 mins. Follow the below table for overridable values. Value Value for Default value namespace.name Namespace Name evicted-pods-cleanup serviceaccount.name ServiceAccount Name podevict-sa clusterrole.name ClusterRole Name romove-evicted clusterrolebinding.name ClusterRoleBinding Name romove-evicted cronjob.name Cronjob Name cleanup-evicted-pods cronjob.activedeadlineseconds activeDeadlineSeconds for the Cronjob 1500 cronjob.schedule Schedule for Cronjob /30 * * * (every 30 mins) cronjob.startingdeadlineseconds startingDeadlineSeconds for the Cronjob 180 failedjobshistorylimit failedJobsHistoryLimit to keep 1 successfuljobshistorylimit successfulJobsHistoryLimit to keep 1 If you want to override any of the values. For example, if you want to override the cron timing, follow the below command. helm install remove-evic --set cronjob.schedule='*/20 * * * *' .","title":"Automatically Cleaning Up Evicted Pods"},{"location":"Evicted_Pod_Remove/#kubernetes-automatically-cleaning-up-evicted-pods-workaround","text":"Note: This is a workaround method, not an actual method to remove evicted pods.","title":"Kubernetes \u2014 Automatically Cleaning Up Evicted Pods (Workaround)"},{"location":"Evicted_Pod_Remove/#pod-eviction-can-happen-for-plenty-of-reasons","text":"A few examples are: VerticalPodAutoscaler scaling a Pod When a Node is under resource pressure (CPU, memory, etc.) When a higher priority Pod preempts a lower priority Pod when a Pod\u2019s emptyDir usage exceeds the configured size limit For some reason, the evicted pod will not be removed automatically. In this article, we are introducing a workaround to remove the evicted pods automatically using cronjobs.","title":"Pod eviction can happen for plenty of reasons."},{"location":"Evicted_Pod_Remove/#prerequisites","text":"Kubernetes Cluster admin rights. helm We have developed a helm template for deploying the cronjob for cleanup evicted pods.","title":"Prerequisites"},{"location":"Evicted_Pod_Remove/#the-chart-will-deploy-the-following-resource-on-your-kubernetes-cluster","text":"Namespace Service account Cluster Role Cluster Rolebinding Cronjob","title":"The chart will deploy the following resource on your Kubernetes Cluster."},{"location":"Evicted_Pod_Remove/#deployment","text":"git clone https://github.com/sahirabbas/remove_evicted_pods_workaround.git","title":"Deployment:"},{"location":"Evicted_Pod_Remove/#deploy-the-cronjob-using-helm","text":"cd remove_evicted_pods_workaround helm install <name> . By default, the chart will create a namespace evicted-pods-cleanup and will deploy the cronjob on the namespace and the cronjob will run every 30 mins. Follow the below table for overridable values. Value Value for Default value namespace.name Namespace Name evicted-pods-cleanup serviceaccount.name ServiceAccount Name podevict-sa clusterrole.name ClusterRole Name romove-evicted clusterrolebinding.name ClusterRoleBinding Name romove-evicted cronjob.name Cronjob Name cleanup-evicted-pods cronjob.activedeadlineseconds activeDeadlineSeconds for the Cronjob 1500 cronjob.schedule Schedule for Cronjob /30 * * * (every 30 mins) cronjob.startingdeadlineseconds startingDeadlineSeconds for the Cronjob 180 failedjobshistorylimit failedJobsHistoryLimit to keep 1 successfuljobshistorylimit successfulJobsHistoryLimit to keep 1 If you want to override any of the values. For example, if you want to override the cron timing, follow the below command. helm install remove-evic --set cronjob.schedule='*/20 * * * *' .","title":"Deploy the cronjob using helm."}]}